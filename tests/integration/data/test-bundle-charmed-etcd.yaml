# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.

name: integration-test-managed-etcd
description: |-
  Used to deploy or refresh within an integration test model
series: jammy
applications:
  ssc:
    charm: self-signed-certificates
    channel: "1/stable"
    base: ubuntu@24.04
    constraints: cores=1 mem=4G root-disk=16G
    num_units: 1
  charmed-etcd:
    # charm: charmed-etcd
    charm: /home/ubuntu/charmed-etcd-operator/charmed-etcd_ubuntu@24.04-amd64.charm
    # channel: "3.6/edge"
    base: ubuntu@24.04
    constraints: cores=2 mem=8G root-disk=16G
    num_units: 1
  k8s:
    charm: /home/ubuntu/k8s-operator/k8s_ubuntu-22.04-amd64.charm
    num_units: 1
    constraints: cores=2 mem=8G root-disk=16G
    options:
      bootstrap-datastore: etcd
      bootstrap-node-taints: "node-role.kubernetes.io/control-plane=:NoSchedule"
  k8s-worker:
    charm: /home/ubuntu/k8s-operator/k8s-worker_ubuntu-22.04-amd64.charm
    constraints: cores=2 mem=8G root-disk=16G
    num_units: 1
relations:
  - [k8s, k8s-worker:cluster]
  - [k8s, k8s-worker:containerd]
  - [k8s:etcd-client, charmed-etcd]
  - [k8s:etcd-certificates, ssc]
  - [charmed-etcd:client-certificates, ssc]
  